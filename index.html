<!doctype html>
<html lang="pt">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Meu Cassino — BacBo (funcional)</title>
<!-- Three.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r148/three.min.js"></script>
<style>
:root{--bg:#071428;--card:#0b1220;--text:#eaf2ff;--muted:#9fb0c8;--banca:#e74c3c;--player:#3498db;--empate:#f2c94c;--accent:#7c3aed;}
*{box-sizing:border-box}body{margin:0;background:linear-gradient(180deg,var(--bg),#031220);color:var(--text);font-family:Inter,Arial,Helvetica,sans-serif}
.container{max-width:1100px;margin:12px auto;padding:12px}
.header{display:flex;justify-content:space-between;align-items:center}
.brand{font-weight:900}
.small{color:var(--muted);font-size:0.9rem}
.panel{background:rgba(255,255,255,0.02);border-radius:10px;padding:12px;margin-top:12px;border:1px solid rgba(255,255,255,0.03)}
.grid{display:grid;grid-template-columns:1fr 360px;gap:12px}
@media(max-width:980px){.grid{grid-template-columns:1fr}}
.scene{height:380px;border-radius:10px;overflow:hidden;border:1px solid rgba(255,255,255,0.03)}
.controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
.btn{padding:10px 12px;border-radius:10px;border:0;background:var(--accent);color:#000;font-weight:800;cursor:pointer}
.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--text)}
.file{padding:8px;border-radius:8px;border:1px dashed rgba(255,255,255,0.06);background:transparent;color:var(--text)}
.sinal{display:flex;align-items:center;justify-content:space-between;padding:12px;border-radius:10px;margin-top:12px;font-weight:800}
.dot{width:18px;height:18px;border-radius:6px}
.pred-list{display:flex;gap:8px;margin-top:8px;flex-wrap:wrap}
.pred{padding:8px 12px;border-radius:10px;font-weight:800;color:#000}
.history{max-height:320px;overflow:auto;margin-top:12px;border-radius:8px;padding:8px;background:rgba(255,255,255,0.01)}
.hist-row{display:flex;justify-content:space-between;padding:8px;border-bottom:1px dashed rgba(255,255,255,0.03)}
.footer{margin-top:12px;text-align:center;color:var(--muted);font-size:0.85rem}
.loginOverlay{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.6);z-index:999}
.loginBox{background:linear-gradient(180deg,#081426,#071428);padding:18px;border-radius:12px;border:1px solid rgba(255,255,255,0.04);width:95%;max-width:420px}
.loginBox input{width:100%;padding:12px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:var(--text)}
.loginBox button{margin-top:10px;width:100%;padding:12px;border-radius:8px;border:0;background:var(--accent);font-weight:800;color:#000}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <div>
      <div class="brand">Meu Cassino — BacBo</div>
      <div class="small">Envie um print-shot → o robô analisa e gera previsão</div>
    </div>
    <div class="small">Sessão: <span id="sessionName">—</span></div>
  </div>

  <div class="grid">
    <!-- Left -->
    <div>
      <div class="panel">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div><strong>Mesa 3D</strong><div class="small">Visual leve e estável</div></div>
          <div class="small">Intervalo auto: <span id="intervalLabel">6s</span></div>
        </div>

        <div id="scene" class="scene"></div>

        <div class="controls">
          <label class="file">Imagem: <input id="img" type="file" accept="image/*" style="margin-left:8px"/></label>
          <button id="btnAuto" class="btn ghost">Auto-Sim (Desligado)</button>
          <input id="seed" placeholder="seed (opcional)" style="padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:var(--text)" />
          <button id="btnClear" class="btn ghost">Limpar</button>
        </div>

        <div class="sinal">
          <div style="display:flex;align-items:center;gap:12px">
            <div class="dot" id="dot" style="background:#888"></div>
            <div id="signalText">Sinal: —</div>
          </div>
          <div class="small" id="last">Última análise: —</div>
        </div>

        <div class="panel" style="margin-top:12px">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div><strong>Previsões</strong><div class="small">Próximas 2–3</div></div>
            <div class="small">Algoritmo: <span id="algo">Mulberry32</span></div>
          </div>
          <div id="preds" class="pred-list"></div>
        </div>
      </div>
    </div>

    <!-- Right -->
    <div>
      <div class="panel">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div><strong>Histórico</strong><div class="small">Últimas 50 detecções</div></div>
          <div><button id="btnGen" class="btn">Gerar Prev</button></div>
        </div>
        <div id="history" class="history"></div>

        <div style="margin-top:12px" class="small">Estatísticas</div>
        <div style="display:flex;gap:8px;margin-top:8px;flex-wrap:wrap">
          <div class="small">Rodadas: <span id="count">0</span></div>
          <div class="small">Coincidências: <span id="match">0</span></div>
        </div>
      </div>
    </div>
  </div>

  <div class="footer">© Meu Cassino — treino apenas</div>
</div>

<div id="loginOverlay" class="loginOverlay">
  <div class="loginBox">
    <div style="margin-bottom:8px"><strong>Entrar na sessão</strong><div class="small">Insere teu nome</div></div>
    <input id="loginName" placeholder="Ex: Graciano" />
    <button id="loginBtn">Entrar</button>
  </div>
</div>

<script>
/* ---------- helpers ---------- */
const $ = id => document.getElementById(id);
function rgbToHsv(r,g,b){ r/=255;g/=255;b/=255;const max=Math.max(r,g,b), min=Math.min(r,g,b);let h=0,s=0,v=max;const d=max-min; s = max===0?0:d/max; if(max!==min){ switch(max){ case r: h=(g-b)/d + (g<b?6:0); break; case g: h=(b-r)/d + 2; break; case b: h=(r-g)/d + 4; break;} h/=6; } return {h:Math.round(h*360), s:Math.round(s*100), v:Math.round(v*100)}; }
function mapHsv(hsv){ const h=hsv.h, s=hsv.s, v=hsv.v; if(s<10 && v>90) return {o:null,label:'Indefinido'}; if((h>=340&&h<=360)||(h>=0&&h<=28)) return {o:'B',label:'Banca',color:getComputedStyle(document.documentElement).getPropertyValue('--banca')}; if(h>=190&&h<=260) return {o:'P',label:'Player',color:getComputedStyle(document.documentElement).getPropertyValue('--player')}; if(h>=30&&h<=90) return {o:'

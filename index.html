<!doctype html>
<html lang="pt">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Robô + Meu Cassino — Simulador de Coincidências</title>
<style>
:root{
  --bg:#071027; --card:#0b1220; --accent:#7c3aed; --muted:#94a3b8;
  --banca:#e74c3c; --jogador:#3498db; --empate:#2ecc71; --glass: rgba(255,255,255,0.02);
}
*{box-sizing:border-box}
body{font-family:Inter,Arial,Helvetica,sans-serif;background:linear-gradient(180deg,#051027,#071428);color:#e6eef6;margin:0;padding:18px}
.container{max-width:980px;margin:0 auto}
.header{display:flex;align-items:center;gap:12px}
.header h1{font-size:1.2rem;margin:0}
.subtitle{color:var(--muted);font-size:0.9rem}
.grid{display:grid;grid-template-columns:1fr 380px;gap:14px;margin-top:12px}
.card{background:var(--card);padding:14px;border-radius:12px;box-shadow:0 8px 30px rgba(0,0,0,0.6);border:1px solid rgba(255,255,255,0.02)}
.small{font-size:0.86rem;color:var(--muted)}
.row{display:flex;gap:8px;align-items:center}
.input, textarea{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}
textarea{min-height:80px}
.button{padding:10px 12px;background:var(--accent);color:white;border:0;border-radius:8px;cursor:pointer;font-weight:700}
.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06)}
.box-sinal{display:flex;gap:8px;margin-top:12px;align-items:center}
.sinal-pill{padding:10px 14px;border-radius:10px;font-weight:800}
.banca{background:var(--banca)} .jogador{background:var(--jogador)} .empate{background:var(--empate)}
.history{max-height:300px;overflow:auto;margin-top:10px;border-radius:8px;padding:6px;background:var(--glass)}
.hist-item{display:flex;justify-content:space-between;padding:8px;border-bottom:1px dashed rgba(255,255,255,0.02)}
.stats{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
.stat{padding:8px 10px;border-radius:8px;background:rgba(255,255,255,0.02);font-weight:700}
.footer{margin-top:12px;color:var(--muted);font-size:0.9rem;text-align:center}
@media(max-width:920px){.grid{grid-template-columns:1fr;}}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <h1>Robô & Meu Cassino — Simulador de Coincidências</h1>
  </div>
  <div class="subtitle">Cria o teu gerador pseudo‑aleatório e o robô. Compara com resultados reais que tu inserires — regista coincidências.</div>

  <div class="grid">
    <!-- Left: controls -->
    <div class="card">
      <h3>1) Configuração dos geradores</h3>
      <div class="small">Escolhe algoritmo PRNG e seeds (mesma seed = mesmas sequências)</div>
      <div style="margin-top:8px" class="row">
        <label class="small">Algoritmo:</label>
        <select id="algo" class="input" style="width:220px">
          <option value="math">Math.random (padrão)</option>
          <option value="mulberry">Mulberry32 (seeded)</option>
          <option value="xorshift">Xorshift32 (seeded)</option>
        </select>
      </div>
      <div style="margin-top:8px" class="row">
        <label class="small">Seed (meu cassino):</label>
        <input id="seedA" class="input" placeholder="ex: 12345" />
      </div>
      <div style="margin-top:8px" class="row">
        <label class="small">Seed (robô):</label>
        <input id="seedB" class="input" placeholder="ex: 777" />
      </div>

      <div style="margin-top:12px">
        <button id="btnInit" class="button">Inicializar Geradores</button>
        <button id="btnStep" class="button ghost">Gerar 1 rodada (manual)</button>
        <button id="btnAutoStep" class="button ghost">Auto (desligado)</button>
      </div>

      <hr style="margin:12px 0;border:none;border-top:1px solid rgba(255,255,255,0.03)">

      <h3>2) Modos</h3>
      <div class="small">Escolhe o modo de operação</div>
      <div style="margin-top:8px" class="row">
        <label><input type="radio" name="mode" value="independent" checked /> Geradores independentes</label>
      </div>
      <div class="row" style="margin-top:6px">
        <label><input type="radio" name="mode" value="syncseed" /> Mesmo seed (sincronizar sequências)</label>
      </div>
      <div class="row" style="margin-top:6px">
        <label><input type="radio" name="mode" value="livecompare" /> Comparar com resultado real (manualmente inserir)</label>
      </div>

      <hr style="margin:12px 0;border:none;border-top:1px solid rgba(255,255,255,0.03)">

      <h3>3) Resultado real (opcional)</h3>
      <div class="small">Se estiveres a jogar no casino real, insere o resultado real aqui para comparar</div>
      <div style="margin-top:8px" class="row">
        <input id="realInput" class="input" placeholder="Insere: B ou J ou E" maxlength="1">
        <button id="btnCheck" class="button ghost">Comparar com previsão</button>
      </div>

      <div style="margin-top:10px" class="small">Controles de velocidade (auto):</div>
      <div style="margin-top:6px" class="row">
        <label class="small">Intervalo (seg):</label>
        <input id="interval" class="input" value="6" style="width:80px"/>
      </div>
    </div>

    <!-- Right: displays -->
    <div class="card">
      <h3>Síntese</h3>
      <div class="box-sinal">
        <div>
          <div class="small">Meu Cassino (próprio)</div>
          <div id="outA" class="sinal-pill banca">—</div>
        </div>
        <div>
          <div class="small">Robô (previsão)</div>
          <div id="outB" class="sinal-pill jogador">—</div>
        </div>
      </div>

      <div style="margin-top:12px" class="small">Última comparação:</div>
      <div id="lastCompare" class="small" style="margin-top:6px">—</div>

      <div style="margin-top:12px" class="small">Estatísticas</div>
      <div class="stats">
        <div class="stat">Rodadas: <span id="statRounds">0</span></div>
        <div class="stat">Coincidências: <span id="statMatch">0</span></div>
        <div class="stat">Taxa de acerto: <span id="statPct">0%</span></div>
      </div>

      <div style="margin-top:12px">
        <div class="small">Histórico (meu cassino | robô | real [se inserido])</div>
        <div class="history" id="histArea"></div>
      </div>

      <div style="margin-top:12px" class="row">
        <button id="btnExport" class="button ghost">Exportar Log</button>
        <button id="btnReset" class="button ghost">Resetar</button>
      </div>

      <div style="margin-top:12px" class="footer">
        <strong>Atenção:</strong> isto é um simulador. Não há garantia de ganhos reais — é uma comparação entre dois geradores pseudo‑aleatórios.
      </div>
    </div>
  </div>
</div>

<script>
/* PRNGs: Mulberry32, Xorshift32 and Math.random fallback */
function mulberry32(a){ return function(){ a |= 0; a = a + 0x6D2B79F5 | 0; var t = Math.imul(a ^ a >>> 15, 1 | a); t = t + Math.imul(t ^ t >>> 7, 61 | t) ^ t; return ((t ^ t >>> 14) >>> 0) / 4294967296; }; }
function xorshift32(seed){ let x = seed >>> 0; return function(){ x ^= x << 13; x ^= x >>> 17; x ^= x << 5; return ((x >>> 0) / 4294967296); }; }

/* mapping random to BacBo outcomes:
   0..0.49 -> B (Banca)
   0.49..0.98 -> J (Jogador)
   0.98..1 -> E (Empate)   (approx rates; podes ajustar)
*/
function pickOutcome(r){
  if(r < 0.49) return 'B';
  if(r < 0.98) return 'J';
  return 'E';
}

/* state */
let genA = Math.random; // meu cassino
let genB = Math.random; // robô
let mode = 'independent';
let roundsCount = 0;
let matches = 0;
let hist = []; // {a,b,real,match,time}
let autoTimer = null;

/* UI refs */
const algo = document.getElementById('algo'), seedA = document.getElementById('seedA'), seedB = document.getElementById('seedB');
const btnInit = document.getElementById('btnInit'), btnStep = document.getElementById('btnStep'), btnAutoStep = document.getElementById('btnAutoStep');
const outA = document.getElementById('outA'), outB = document.getElementById('outB'), histArea = document.getElementById('histArea');
const statRounds = document.getElementById('statRounds'), statMatch = document.getElementById('statMatch'), statPct = document.getElementById('statPct');
const btnCheck = document.getElementById('btnCheck'), realInput = document.getElementById('realInput');
const btnExport = document.getElementById('btnExport'), btnReset = document.getElementById('btnReset'), intervalInput = document.getElementById('interval');
const lastCompare = document.getElementById('lastCompare');

/* helpers */
function parseSeed(s){ const n = parseInt(s); return isNaN(n)? (Math.floor(Math.random()*999999)) : n; }
function initGenerators(){
  const a = parseSeed(seedA.value||Date.now());
  const b = parseSeed(seedB.value||(Date.now()+1));
  const selected = algo.value;
  if(selected === 'mulberry'){
    genA = mulberry32(a);
    genB = mulberry32(b);
  } else if(selected === 'xorshift'){
    genA = xorshift32(a);
    genB = xorshift32(b);
  } else {
    genA = Math.random;
    genB = Math.random;
  }
  mode = document.querySelector('input[name="mode"]:checked').value;
  appendLog(`Inicializado: algoritmo=${selected}, seedA=${a}, seedB=${b}, modo=${mode}`);
  resetStats(false);
}
function stepOnce(useAuto=false){
  // gerar outcomes
  const rA = (genA === Math.random) ? Math.random() : genA();
  const rB = (genB === Math.random) ? Math.random() : genB();
  const outAchar = pickOutcome(rA);
  const outBchar = pickOutcome(rB);

  // se modo syncseed e seeds iguais, forçar same generator? (user can set same seed)
  // we'll leave it natural: if seeds equal in seeded algos, sequences will match
  // handle mode logic
  const real = realInput.value.trim().toUpperCase();
  let realVal = real === 'B' || real === 'J' || real === 'E' ? real : null;

  // if mode is livecompare and user inserted real, compare robot => real
  const match = (realVal && realVal === outBchar) ? true : (outAchar === outBchar ? true : false);

  const rec = {a: outAchar, b: outBchar, real: realVal, match, time: new Date().toLocaleTimeString()};
  hist.unshift(rec); if(hist.length>300) hist.pop();
  roundsCount++;
  if(match) matches++;
  updateUI(rec);
  // if mode livecompare and there's a realVal, clear the input (to mimic new round later)
  if(useAuto && realVal) realInput.value = '';
}
function updateUI(latest){
  outA.textContent = decode(latest.a); outA.className = 'sinal-pill ' + cls(latest.a);
  outB.textContent = decode(latest.b); outB.className = 'sinal-pill ' + cls(latest.b);
  lastCompare.textContent = `Últ.: A=${decode(latest.a)} | B=${decode(latest.b)} | real=${latest.real||'–'} | match=${latest.match?'SIM':'NÃO'} @ ${latest.time}`;
  renderHist();
  statRounds.textContent = roundsCount;
  statMatch.textContent = matches;
  statPct.textContent = (roundsCount>0 ? Math.round(matches/roundsCount*100) : 0) + '%';
  if(latest.match){
    // visual + som (onde suportado)
    flash();
  }
}
function renderHist(){
  histArea.innerHTML = hist.map((h,i)=>`<div class="hist-item"><div><strong>#${i+1}</strong> ${h.time}</div><div>A:${decode(h.a)} | B:${decode(h.b)} ${h.real?('| R:'+decode(h.real)) : ''} ${h.match?'<span style="color:#ffd166;font-weight:800;margin-left:8px">MATCH</span>':''}</div></div>`).join('');
}
function cls(ch){ return ch==='B'?'banca':(ch==='J'?'jogador':'empate'); }
function decode(ch){ return ch==='B'?'Banca':(ch==='J'?'Jogador':'Empate'); }
function appendLog(txt){ console.log('[sim] '+txt); }
function flash(){
  // breve animação visual
  document.body.style.transition='background 0.25s';
  const old = document.body.style.background;
  document.body.style.background='linear-gradient(90deg,#0b3a2b,#071428)';
  setTimeout(()=> document.body.style.background=old,250);
  // sound beep (short)
  try{
    const ctx = new (window.AudioContext || window.webkitAudioContext)();
    const o = ctx.createOscillator();
    const g = ctx.createGain();
    o.type='sine'; o.frequency.value=800; g.gain.value=0.02;
    o.connect(g); g.connect(ctx.destination);
    o.start(); setTimeout(()=>{ o.stop(); ctx.close(); },120);
  }catch(e){}
}

/* UI wiring */
btnInit.addEventListener('click', ()=> initGenerators());
btnStep.addEventListener('click', ()=> stepOnce(false));

let autoOn = false;
btnAutoStep.addEventListener('click', ()=>{
  autoOn = !autoOn;
  if(autoOn){
    btnAutoStep.textContent = 'Auto (ligado)';
    btnAutoStep.classList.remove('ghost');
    const sec = Math.max(1, parseFloat(intervalInput.value)||6) * 1000;
    autoTimer = setInterval(()=> stepOnce(true), sec);
  } else {
    btnAutoStep.textContent = 'Auto (desligado)';
    btnAutoStep.classList.add('ghost');
    clearInterval(autoTimer);
  }
});

btnCheck.addEventListener('click', ()=>{
  // compare last prediction with real input
  if(hist.length===0) return alert('Ainda não geraste nenhuma rodada');
  const last = hist[0];
  const real = realInput.value.trim().toUpperCase();
  if(!['B','J','E'].includes(real)) return alert('Insere B, J ou E no campo real');
  last.real = real;
  last.match = (last.b === real) || (last.a === last.b);
  if(last.match) matches++;
  updateUI(last);
  realInput.value = '';
});

btnExport.addEventListener('click', ()=>{
  const text = hist.map(h=>`${h.time} | A:${h.a} | B:${h.b} | R:${h.real||'-'} | M:${h.match}`).join('\n');
  const blob = new Blob([text], {type:'text/plain;charset=utf-8'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = 'sim_log.txt'; a.click(); URL.revokeObjectURL(url);
});

btnReset.addEventListener('click', ()=>{
  roundsCount = 0; matches = 0; hist = []; updateUI({a:'-',b:'-',real:null,match:false,time:'-'});
  statRounds.textContent = '0'; statMatch.textContent='0'; statPct.textContent='0%'; histArea.innerHTML='';
});

/* init default */
initGenerators();
</script>
</body>
</html>
